# ===== Stage 1: copy schema from backend =====
FROM node:20-alpine AS backend-schema
WORKDIR /src
# ğŸ”¹ copy à¹€à¸‰à¸à¸²à¸° schema à¸ˆà¸²à¸ backend
COPY backend/prisma/schema.prisma ./prisma/schema.prisma

# ===== Stage 2: build frontend =====
FROM node:20-alpine

WORKDIR /app

# ğŸ”¹ à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ dependencies à¸‚à¸­à¸‡ frontend
COPY frontend/package*.json ./
RUN npm install

# ğŸ”¹ copy schema à¸ˆà¸²à¸ stage à¹à¸£à¸ (à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™)
COPY --from=backend-schema /src/prisma/schema.prisma ./prisma/schema.prisma

# ğŸ”¹ copy code à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸‚à¸­à¸‡ frontend
COPY frontend . .

# ğŸ”¹ generate Prisma client à¸ˆà¸²à¸ schema à¸—à¸µà¹ˆ copy à¸¡à¸²
RUN npx prisma generate --schema=./prisma/schema.prisma

CMD ["npm", "run", "dev"]
